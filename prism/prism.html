<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prism</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css?v=2">
</head>

<body>

    <div id="control">
        <p>Display Options</p>
        <button id="btnCircle">Circle</button>
        <button id="btnSquare">Square</button>
    </div>

    <div id="description" class="hide">
        <p>Click the box to close. The content will be updated according to the user input.</p>
    </div>

    <div id="colorContainer">
        <div id="colorGrid"></div>
    </div>

    <p id="colorCode" class="hide"></p>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
    </script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-auth.js"></script>
    <script src="../js/util.js"></script>
    <script src="../js/db_handler.js"></script>
    <script>
        const colorList = [

        ];

        const dataEg = [{
            story: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. ",
            name: "Aaron Yang",
            email: "aaron@aaronyang.me",
            userCity: "Fargo",
            userState: "ND",
            userCountry: "USA"
        }];

        const colorGrid = document.querySelector("#colorGrid");
        const descriptionBox = document.querySelector("#description");
        const btnCircle = document.querySelector("#btnCircle");
        const btnSquare = document.querySelector("#btnSquare");
        const control = document.querySelector("#control");

        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const currentColor = '#' + urlParams.get("color");
        const currentUID = urlParams.get("uid");


        addDescription(dataEg[0], currentColor);


        for (let i = 0; i < 500; i++) {
            colorList.push(
                `rgb(${Math.random() * (255 - 0) + 0}, ${Math.random() * (255 - 0) + 0}, ${Math.random() * (255 - 0) + 0})`
                )
        }

        

        colorList.forEach(color => {
            const box = document.createElement('div');
            box.className = "color-box";
            box.style = `background-color: ${color}`;
            box.addEventListener("click", e => {
                addDescription(dataEg[0], color);
            })
            colorGrid.append(box);
        });

        getColor("prism", (data) => {
            Object.values(data).forEach( profile => {
                console.log(profile);
                makeColorBox(profile);
            })
        });

        const myBox = document.createElement('div');
        myBox.className = "color-box user-color-box";
        myBox.style = `background-color: ${currentColor}`;
        myBox.addEventListener("click", e => {
            addDescription(dataEg[0], currentColor);
            // descriptionBox.style.left = e.pageX + "px";
            // descriptionBox.style.top = e.pageY + "px";
        });
        colorGrid.append(myBox);

        document.querySelector("#colorCode").innerHTML = urlParams.get("color");


        descriptionBox.addEventListener("click", e => {
            e.currentTarget.classList.add("hide");
        });

        btnSquare.addEventListener("click", e => {
            document.querySelectorAll(".color-box").forEach(box => {
                box.classList.remove("shap-circle");
                box.classList.add("shape-sqaure");
            })
        });

        btnCircle.addEventListener("click", e => {
            document.querySelectorAll(".color-box").forEach(box => {
                box.classList.add("shap-circle");
                box.classList.remove("shape-sqaure");
            })
        });


        getColorInfo("prism", currentUID, (data) => {
            console.log(data);
        });

        function makeColorBox(profile){
            const box = document.createElement('div');
            box.className = "color-box";
            box.id = profile.uid;
            box.style = `background-color: ${profile.color}`;
            box.addEventListener("click", e => {
                addDescription(profile, profile.color);
                descriptionBox.style.left = e.pageX + "px";
                descriptionBox.style.top = e.pageY + "px";
            })
            colorGrid.append(box);
        }

        function addDescription(info, color) {

            descriptionBox.classList.remove("hide");
            descriptionBox.style = `background-color: ${color}`;
            descriptionBox.innerHTML = "<p>Click the box to close. The content will be updated according to the user input.</p>";
            const nameEle = document.createElement("h4");
            nameEle.innerHTML = info.name;
            const locationEle = document.createElement("p");
            locationEle.innerHTML = info.userCity + ', ' + info.userState + ', ' + info.userCountry;
            const storyEle = document.createElement("p");
            storyEle.innerHTML = info.story;

            descriptionBox.append(nameEle, locationEle, storyEle);
        }
    </script>
</body>

</html>